# 🔐 Git-Crypt Guide for CipherCop 2025

## 📋 Table of Contents
- [Overview](#overview)
- [What We Accomplished](#what-we-accomplished)
- [File Structure](#file-structure)
- [Installation Process](#installation-process)
- [Important Commands](#important-commands)
- [How Encryption Works](#how-encryption-works)
- [Team Collaboration Workflow](#team-collaboration-workflow)
- [Troubleshooting](#troubleshooting)
- [Security Best Practices](#security-best-practices)

---

## 🎯 Overview

Git-crypt is a transparent file encryption tool for git repositories. It allows us to store sensitive files (like `.env` files containing API keys) securely in our git repository while keeping the rest of the code readable.

### 🔑 Key Benefits:
- **Selective Encryption**: Only encrypts specified files (our `.env` files)
- **Transparent Operation**: Encrypted files appear normal when repository is unlocked
- **Team Collaboration**: Secure key sharing for authorized team members
- **Git Integration**: Works seamlessly with normal git workflows

---

## ✅ What We Accomplished

### 1. **Git-Crypt Installation (WSL-based)**
- Installed git-crypt in Windows Subsystem for Linux (WSL)
- Created a Windows wrapper (`C:\git-crypt\git-crypt.bat`) to use WSL version natively in cmd
- Added `C:\git-crypt` to PATH for easy access

### 2. **Environment File Security Setup**
- Created `.gitattributes` file to specify which files to encrypt
- Configured encryption for **ONLY** the 4 `.env` files:
  - `backend/.env`
  - `backend_py/clone-detection/combined-analysis/.env`
  - `backend_py/clone-detection/gemini/.env`
  - `backend_py/phishing-detection/.env`

### 3. **Backup System**
- Created `create_env_backups.py` script to generate `env.txt` backups
- Automatically masks sensitive values in output
- Processes all 4 environment files

### 4. **Setup Automation**
- Created `setup-git-crypt.bat` for easy initialization
- Generated encryption key: `ciphercop-git-crypt.key`
- Configured git repository for encryption

### 5. **Documentation**
- Created `.env.example` files for all services as public templates
- Comprehensive documentation in `ENV-SECURITY-README.md`
- This detailed git-crypt guide

---

## 📁 File Structure

```
ciphercopdemo/
├── 🔐 Git-Crypt Files
│   ├── .gitattributes                    # Encryption configuration
│   ├── ciphercop-git-crypt.key          # 🔑 Encryption key (KEEP SECURE!)
│   ├── setup-git-crypt.bat              # Setup automation script
│   ├── create_env_backups.py            # Backup generation script
│   └── GIT-CRYPT-README.md              # This guide
│
├── 🔒 Encrypted Files (.env files)
│   ├── backend/.env                      # 🔒 ENCRYPTED
│   ├── backend_py/clone-detection/
│   │   ├── combined-analysis/.env        # 🔒 ENCRYPTED
│   │   └── gemini/.env                   # 🔒 ENCRYPTED
│   └── backend_py/phishing-detection/.env # 🔒 ENCRYPTED
│
├── 📄 Public Templates (.env.example files)
│   ├── backend/.env.example              # ✅ Public template
│   ├── backend_py/clone-detection/
│   │   ├── combined-analysis/.env.example # ✅ Public template
│   │   └── gemini/.env.example           # ✅ Public template
│   └── backend_py/phishing-detection/.env.example # ✅ Public template
│
└── 📝 Backup Files (generated by script)
    ├── backend/env.txt
    ├── backend_py/clone-detection/
    │   ├── combined-analysis/env.txt
    │   └── gemini/env.txt
    └── backend_py/phishing-detection/env.txt
```

---

## ⚙️ Installation Process

### **Step 1: WSL Setup**
```cmd
# Check WSL availability
wsl --version

# Install git-crypt in WSL
wsl sudo apt-get update
wsl sudo apt-get install -y git-crypt
```

### **Step 2: Windows Integration**
```cmd
# Create git-crypt directory
mkdir C:\git-crypt

# Copy wrapper script (done automatically)
copy git-crypt.bat "C:\git-crypt\git-crypt.bat"

# Add to PATH (temporary for session)
set "PATH=%PATH%;C:\git-crypt"
```

### **Step 3: Repository Setup**
```cmd
# Run automated setup
setup-git-crypt.bat

# Or manual setup:
git-crypt init
git-crypt export-key ciphercop-git-crypt.key
```

---

## 💻 Important Commands

### **Basic Commands**
```cmd
# Check git-crypt version
git-crypt --version

# Check encryption status of files
git-crypt status

# Initialize git-crypt in repository
git-crypt init

# Export encryption key
git-crypt export-key ciphercop-git-crypt.key
```

### **Lock/Unlock Commands**
```cmd
# Unlock encrypted files (for new team members)
git-crypt unlock ciphercop-git-crypt.key

# Lock files (optional - files auto-encrypt on commit)
git-crypt lock

# Check if repository is locked or unlocked
git-crypt status
```

### **Backup Commands**
```cmd
# Create env.txt backups from all .env files
python create_env_backups.py

# Check backup files were created
dir backend\env.txt
dir backend_py\clone-detection\combined-analysis\env.txt
dir backend_py\clone-detection\gemini\env.txt
dir backend_py\phishing-detection\env.txt
```

### **Git Integration Commands**
```cmd
# Normal git workflow - files auto-encrypt on commit
git add .
git commit -m "Update environment configuration"
git push

# Files are automatically encrypted when committed
# Files are automatically decrypted when repository is unlocked
```

---

## 🔐 How Encryption Works

### **Configuration File: `.gitattributes`**
```properties
# Specifies which files to encrypt
backend/.env filter=git-crypt diff=git-crypt
backend_py/clone-detection/combined-analysis/.env filter=git-crypt diff=git-crypt
backend_py/clone-detection/gemini/.env filter=git-crypt diff=git-crypt
backend_py/phishing-detection/.env filter=git-crypt diff=git-crypt
```

### **Encryption Process**
1. **When you commit**: Git-crypt automatically encrypts specified files before storing in repository
2. **When others clone**: Encrypted files appear as binary data until unlocked
3. **When unlocked**: Files appear as normal text files in working directory
4. **Algorithm**: Uses AES-256 encryption for maximum security

### **What Gets Encrypted vs Not Encrypted**

| File Type | Status | Reason |
|-----------|--------|---------|
| `.env` files | 🔒 **ENCRYPTED** | Contains API keys, secrets |
| `.env.example` files | ✅ **NOT ENCRYPTED** | Public templates |
| Source code (`.py`, `.js`, etc.) | ✅ **NOT ENCRYPTED** | Should be readable |
| Documentation (`.md`) | ✅ **NOT ENCRYPTED** | Public information |
| Configuration files | ✅ **NOT ENCRYPTED** | Unless they contain secrets |

---

## 👥 Team Collaboration Workflow

### **For Repository Owner (Initial Setup)**
```cmd
# 1. Setup git-crypt (already done)
setup-git-crypt.bat

# 2. Add encrypted files to git
git add .gitattributes
git add backend/.env
git add backend_py/clone-detection/combined-analysis/.env
git add backend_py/clone-detection/gemini/.env
git add backend_py/phishing-detection/.env
git commit -m "Add encrypted environment files"
git push

# 3. Share key securely with team members
# Send ciphercop-git-crypt.key via encrypted email or secure file sharing
```

### **For New Team Members**
```cmd
# 1. Clone the repository
git clone https://github.com/Samith-P/ciphercopdemo.git
cd ciphercopdemo

# 2. Setup git-crypt on their machine
# Install WSL and git-crypt (same process as above)

# 3. Unlock encrypted files using shared key
git-crypt unlock ciphercop-git-crypt.key

# 4. Verify files are decrypted
git-crypt status
type backend\.env  # Should show actual content, not binary data

# 5. Create backups if needed
python create_env_backups.py
```

### **For Daily Development**
```cmd
# Normal git workflow - encryption is transparent
git add .
git commit -m "Your changes"
git push

# Files automatically encrypt on commit
# Files automatically decrypt when repository is unlocked
```

---

## 🚨 Troubleshooting

### **Problem: "git-crypt: command not found"**
```cmd
# Solution: Add to PATH
set "PATH=%PATH%;C:\git-crypt"

# Or check if WSL git-crypt is installed
wsl git-crypt --version
```

### **Problem: "This repository has already been initialized"**
```cmd
# This is normal - git-crypt is already setup
# Just export the key if needed
git-crypt export-key ciphercop-git-crypt.key
```

### **Problem: Files showing as binary data**
```cmd
# Repository is locked - unlock it
git-crypt unlock ciphercop-git-crypt.key

# Check status
git-crypt status
```

### **Problem: Permission denied**
```cmd
# Run command prompt as Administrator
# Or check file permissions on key file
```

### **Problem: WSL not available**
```cmd
# Enable WSL in Windows Features
# Or download pre-compiled git-crypt binary for Windows
```

---

## 🛡️ Security Best Practices

### **🔑 Key Management**
- ✅ **Store key in multiple secure locations** (encrypted drives, secure cloud storage)
- ✅ **Share key only through encrypted channels** (ProtonMail, Signal, encrypted USB)
- ✅ **Never commit key to repository** (it's in .gitignore)
- ✅ **Rotate keys periodically** for enhanced security
- ✅ **Limit key access** to authorized team members only

### **🔒 Repository Security**
- ✅ **Verify .gitattributes** is committed and properly configured
- ✅ **Test encryption** by cloning repository without key
- ✅ **Monitor repository access** and key distribution
- ✅ **Use strong git authentication** (SSH keys, 2FA)

### **📱 Team Practices**
- ✅ **Document who has keys** and when they were shared
- ✅ **Revoke access** by generating new keys when needed
- ✅ **Train team members** on proper key handling
- ✅ **Regular security audits** of encrypted files

---

## 📚 Quick Reference

### **Essential Files**
| File | Purpose | Action Required |
|------|---------|-----------------|
| `ciphercop-git-crypt.key` | 🔑 Encryption key | Keep secure, share with team |
| `.gitattributes` | 📝 Encryption config | Commit to repository |
| `setup-git-crypt.bat` | ⚙️ Setup automation | Run once per machine |
| `create_env_backups.py` | 💾 Backup generator | Run when needed |

### **Quick Commands Cheat Sheet**
```cmd
# Setup (one-time)
setup-git-crypt.bat

# Daily use
python create_env_backups.py  # Create backups
git-crypt status              # Check encryption status

# Team member onboarding
git-crypt unlock ciphercop-git-crypt.key

# Emergency
git-crypt lock                # Lock all files
git-crypt unlock ciphercop-git-crypt.key  # Unlock again
```

---

## 🎯 Summary

We successfully implemented a robust environment file security system that:

1. **🔒 Encrypts sensitive `.env` files** containing API keys and secrets
2. **📂 Keeps code readable** - only environment files are encrypted
3. **🤝 Enables secure team collaboration** through encrypted key sharing
4. **🔄 Provides backup functionality** with `env.txt` generation
5. **⚡ Works transparently** with normal git workflows
6. **🛡️ Uses industry-standard AES-256 encryption**

Your sensitive data is now protected while maintaining full development workflow functionality! 🎉

---

*For questions or issues, refer to this guide or check the `ENV-SECURITY-README.md` for additional details.*
